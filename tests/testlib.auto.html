

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Test Library &mdash; VSI Common 0.0.7 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="vsi" href="../python/modules.html" />
    <link rel="prev" title="Test Utilities" href="test_utils.auto.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> VSI Common
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../just/index.html">J.U.S.T. Useful Simple Tasking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../linux/index.html">Linux Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../windows/index.html">Windows Utilities</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Unit Tests</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="run_tests.auto.html">Run Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_colors.auto.html">Test Colors</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_utils.auto.html">Test Utilities</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Test Library</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../python/modules.html">vsi</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docker/recipes/get-pipenv.auto.html">Get Pipenv</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docker/recipes/index.html">Docker recipes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../style.html">Contributing Style Guide</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">VSI Common</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Unit Tests</a> &raquo;</li>
        
      <li>Test Library</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/tests/testlib.auto.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="test-library">
<h1>Test Library<a class="headerlink" href="#test-library" title="Permalink to this headline">¶</a></h1>
<dl class="file">
<dt id="file-testlib.bsh">
<code class="sig-name descname">testlib.bsh</code><a class="headerlink" href="#file-testlib.bsh" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Simple shell command language test library</p>
<p class="rubric">Usage</p>
<p>. testlib.bsh</p>
<p class="rubric">Example</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">Tests must follow the basic form:</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span> testlib.bsh

begin_test <span class="s2">&quot;the thing&quot;</span>
<span class="o">(</span>
     <span class="nb">set</span> -e
     <span class="nb">echo</span> <span class="s2">&quot;hello&quot;</span>
     <span class="o">[</span> <span class="nv">1</span> <span class="o">==</span> <span class="m">1</span> <span class="o">]</span> <span class="c1"># this is ok</span>
     <span class="c1"># However, the following needs &quot;|| false&quot; because on bash 3.2 and 4.0</span>
     <span class="c1"># there is a bug where [[ ]] will fail, and bash knows it fails ($?),</span>
     <span class="c1"># but &quot;set -e&quot; does not count this as an error. This is fixed in bash 4.1</span>
     <span class="o">[[</span> <span class="nv">1</span> <span class="o">==</span> <span class="m">1</span> <span class="o">]]</span> <span class="o">||</span> <span class="nb">false</span>
     <span class="nb">false</span>
<span class="o">)</span>
end_test

When a <span class="nb">test</span> fails its stdout and stderr are shown.
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Tests must ‘set -e’ within the subshell block or failed assertions will not cause the test to fail and the result may be misreported. While this is not required, most tests will have this on.</p>
</div>
<p class="rubric">Bugs</p>
<p>On darling: when debugging a unit test error, sometimes the printout is cut off, making it difficult to do “printf debugging.” While the cause and scope of this is unknown, a work around that sometimes works is</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>runtests <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="p">|</span> less -R
</pre></div>
</div>
<dl class="field-list">
<dt class="field-odd">Copyright</dt>
<dd class="field-odd"><p>Original version: (c) 2011-13 by Ryan Tomayko &lt;<a class="reference external" href="http://tomayko.com">http://tomayko.com</a>&gt;</p>
<p>License: MIT</p>
</dd>
<dt class="field-even">Author</dt>
<dd class="field-even"><p>Ryan Tomayko</p>
</dd>
<dt class="field-odd">Modification History</dt>
<dd class="field-odd"><p>Andy Neff</p>
<ul class="simple">
<li><p>Added <a class="reference internal" href="#function-testlib.bsh begin_expected_fail_test"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">begin_expected_fail_test</span></code></a></p></li>
<li><p>Added optional <a class="reference internal" href="#function-testlib.bsh setup"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">setup</span></code></a>/<a class="reference internal" href="#function-testlib.bsh teardown"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">teardown</span></code></a> functions</p></li>
<li><p>Removed PATH</p></li>
<li><p>Added robodoc documentation</p></li>
<li><p>Use pushd/popd for each test instead of cd</p></li>
<li><p>Auto prepend filename to description</p></li>
<li><p>Added custom PS4</p></li>
</ul>
</dd>
</dl>
<dl class="function">
<dt id="function-testlib.bsh setup">
<code class="sig-name descname">setup</code><a class="headerlink" href="#function-testlib.bsh setup" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Function run before the first test</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A directory <span class="target" id="index-0"></span><a class="reference internal" href="#envvar-TRASHDIR"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">TRASHDIR</span></code></a> is created for setup, right before running <a class="reference internal" href="#function-testlib.bsh setup"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">setup</span></code></a> ().</p>
<p>Setup is not run if no tests are ever run</p>
</div>
<dl class="envvar">
<dt id="envvar-TRASHDIR">
<code class="sig-name descname">TRASHDIR</code><a class="headerlink" href="#envvar-TRASHDIR" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Temporary directory where everything for the test file is stored</p>
<p>Automatically generated and removed (unless <span class="target" id="index-1"></span><a class="reference internal" href="#envvar-TESTLIB_KEEP_TEMP_DIRS"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">TESTLIB_KEEP_TEMP_DIRS</span></code></a> is changed)</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><span class="target" id="index-2"></span><a class="reference internal" href="#envvar-TESTDIR"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">TESTDIR</span></code></a></p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Author</dt>
<dd class="field-odd"><p>Ryan Tomayko</p>
</dd>
</dl>
<dl class="envvar">
<dt id="envvar-TESTDIR">
<code class="sig-name descname">TESTDIR</code><a class="headerlink" href="#envvar-TESTDIR" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Unique temporary directory for a single test (in <span class="target" id="index-3"></span><a class="reference internal" href="#envvar-TRASHDIR"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">TRASHDIR</span></code></a>)</p>
<p>Automatically generated and removed (unless <span class="target" id="index-4"></span><a class="reference internal" href="#envvar-TESTLIB_KEEP_TEMP_DIRS"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">TESTLIB_KEEP_TEMP_DIRS</span></code></a> is changed)</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><span class="target" id="index-5"></span><a class="reference internal" href="#envvar-TRASHDIR"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">TRASHDIR</span></code></a></p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Author</dt>
<dd class="field-odd"><p>Ryan Tomayko</p>
</dd>
</dl>
<dl class="function">
<dt id="function-testlib.bsh teardown">
<code class="sig-name descname">teardown</code><a class="headerlink" href="#function-testlib.bsh teardown" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Function run after the last test</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Teardown is not run if no tests are ever run</p>
</div>
<dl class="envvar">
<dt id="envvar-TESTLIB_KEEP_TEMP_DIRS">
<code class="sig-name descname">TESTLIB_KEEP_TEMP_DIRS</code><a class="headerlink" href="#envvar-TESTLIB_KEEP_TEMP_DIRS" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Keep the trashdir/setup dir</p>
<p>Debug flag to keep the temporary directories generated when testing. Set to <code class="docutils literal notranslate"><span class="pre">1</span></code> to keep directories.</p>
<dl class="field-list simple">
<dt class="field-odd">Default</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">0</span></code></p>
</dd>
</dl>
<dl class="envvar">
<dt id="envvar-TESTLIB_SHOW_TIMING">
<code class="sig-name descname">TESTLIB_SHOW_TIMING</code><a class="headerlink" href="#envvar-TESTLIB_SHOW_TIMING" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Display test time after each test</p>
<p>Debug flag to display time elapsed for each test. Set to <code class="docutils literal notranslate"><span class="pre">1</span></code> to enable.</p>
<dl class="field-list simple">
<dt class="field-odd">Default</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">0</span></code></p>
</dd>
</dl>
<dl class="envvar">
<dt id="envvar-TESTLIB_RUN_SINGLE_TEST">
<code class="sig-name descname">TESTLIB_RUN_SINGLE_TEST</code><a class="headerlink" href="#envvar-TESTLIB_RUN_SINGLE_TEST" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Run a single test</p>
<p>Instead of running all the tests in a test file, only the tests with a description exactly matching the value of <span class="target" id="index-6"></span><a class="reference internal" href="#envvar-TESTLIB_RUN_SINGLE_TEST"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">TESTLIB_RUN_SINGLE_TEST</span></code></a> will be run. Useful for debugging a specific test/piece of code</p>
<dl class="field-list simple">
<dt class="field-odd">Default</dt>
<dd class="field-odd"><p><em>unset</em></p>
</dd>
</dl>
<dl class="envvar">
<dt id="envvar-TESTLIB_SKIP_TESTS">
<code class="sig-name descname">TESTLIB_SKIP_TESTS</code><a class="headerlink" href="#envvar-TESTLIB_SKIP_TESTS" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>A bash regex expressions that designates tests to be skipped.</p>
<dl class="field-list simple">
<dt class="field-odd">Default</dt>
<dd class="field-odd"><p><em>unset</em></p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">TESTLIB_SKIP_TESTS</span><span class="o">=</span><span class="s1">&#39;^New Just$|foo&#39;</span>
<span class="c1"># Skip &quot;New Just&quot; and anything with &quot;foo&quot; it is, e.g. &quot;food&quot;</span>
</pre></div>
</div>
<dl class="envvar">
<dt id="envvar-TESTLIB_REDIRECT_OUTPUT">
<code class="sig-name descname">TESTLIB_REDIRECT_OUTPUT</code><a class="headerlink" href="#envvar-TESTLIB_REDIRECT_OUTPUT" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Redirects stdout and stderr to temporary files</p>
<p>By default, all tests are run with <code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">-xv</span></code> for debugging purposes when a tests fails. This output is stored in a out/err/xtrace file temporarily and only displayed if a tests fails. You can set this variable to control the streams to always output.</p>
<dl class="field-list simple">
<dt class="field-odd">Values</dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">3</span></code> Redirect stdout, stderr, and xtrace</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">2</span></code> Redirect stderr, and xtrace, but let stdout through</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> Redirect xtrace, but let stdout and stderr through. On bash 4.0 and older, this will let xtrace through too</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> Let everything through</p></li>
</ul>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p><code class="docutils literal notranslate"><span class="pre">3</span></code></p>
</dd>
</dl>
<dl class="envvar">
<dt id="envvar-TESTLIB_NO_PS4">
<code class="sig-name descname">TESTLIB_NO_PS4</code><a class="headerlink" href="#envvar-TESTLIB_NO_PS4" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>If set, will disable the custom PS4 output. Useful for some coverage tools</p>
<dl class="field-list simple">
<dt class="field-odd">Default</dt>
<dd class="field-odd"><p><em>unset</em></p>
</dd>
</dl>
<dl class="function">
<dt id="function-testlib.bsh atexit">
<code class="sig-name descname">atexit</code><a class="headerlink" href="#function-testlib.bsh atexit" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Function that runs at process exit</p>
<p class="rubric">Usage</p>
<p>Automatically called on exit by trap.</p>
<p>Checks to see if teardown is defined, and calls it. teardown is typically a function, alias, or something that makes sense to call.</p>
<dl class="field-list simple">
<dt class="field-odd">Author</dt>
<dd class="field-odd"><p>Ryan Tomaydo</p>
</dd>
<dt class="field-even">Modification History</dt>
<dd class="field-even"><p>Andy Neff</p>
<ul class="simple">
<li><p>Added <a class="reference internal" href="#function-testlib.bsh setup"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">setup</span></code></a> cleanup</p></li>
<li><p>Added <a class="reference internal" href="#function-testlib.bsh teardown"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">teardown</span></code></a></p></li>
<li><p>Added <span class="target" id="index-7"></span><a class="reference internal" href="#envvar-TESTLIB_KEEP_TEMP_DIRS"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">TESTLIB_KEEP_TEMP_DIRS</span></code></a> flags</p></li>
</ul>
</dd>
</dl>
<dl class="function">
<dt id="function-testlib.bsh begin_test">
<code class="sig-name descname">begin_test</code><a class="headerlink" href="#function-testlib.bsh begin_test" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Beginning of test demarcation</p>
<p class="rubric">Usage</p>
<p>Mark the beginning of a test. A subshell should immediately follow this statement.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#function-testlib.bsh end_test"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">end_test</span></code></a></p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Author</dt>
<dd class="field-odd"><p>Ryan Tomayko</p>
</dd>
</dl>
<dl class="function">
<dt id="function-testlib.bsh begin_expected_fail_test">
<code class="sig-name descname">begin_expected_fail_test</code><a class="headerlink" href="#function-testlib.bsh begin_expected_fail_test" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Beginning of expected fail test demarcation</p>
<p class="rubric">Usage</p>
<p>Define the beginning of a test that is expected to fail</p>
<dl class="function">
<dt id="function-testlib.bsh begin_required_fail_test">
<code class="sig-name descname">begin_required_fail_test</code><a class="headerlink" href="#function-testlib.bsh begin_required_fail_test" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Beginning of required fail test demarcation</p>
<p class="rubric">Usage</p>
<p>Define the beginning of a test that is required to fail</p>
<dl class="function">
<dt id="function-testlib.bsh setup_test">
<code class="sig-name descname">setup_test</code><a class="headerlink" href="#function-testlib.bsh setup_test" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Sets up the test</p>
<p>Once inside the () subshell, typically set -eu needs to be run, then other things such as checking to see if a test should be skipped, etc. need to be done. This is all encapsulated into <a class="reference internal" href="#function-testlib.bsh setup_test"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">setup_test</span></code></a>. This is required; without it, <a class="reference internal" href="#function-testlib.bsh end_test"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">end_test</span></code></a> will know you forgot to call this and fail.</p>
<p>This is also the second part of creating a skippable test.</p>
<p>You are free to change “set -eu” after <a class="reference internal" href="#function-testlib.bsh setup_test"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">setup_test</span></code></a>, should you wish.</p>
<p class="rubric">Usage</p>
<p>Place at the beginning of a test</p>
<p class="rubric">Example</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>skip_next_test
begin_test <span class="s2">&quot;Skipping test&quot;</span>
<span class="o">(</span>
  setup_test
  <span class="c1">#test code here</span>
<span class="o">)</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#function-testlib.bsh skip_next_test"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">skip_next_test</span></code></a></p>
</div>
<dl class="function">
<dt id="function-testlib.bsh end_test">
<code class="sig-name descname">end_test</code><a class="headerlink" href="#function-testlib.bsh end_test" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>End of a test demarcation</p>
<p class="rubric">Usage</p>
<p>Mark the end of a test. Must be the first command after the test group, or else the return value will not be captured successfully.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#function-testlib.bsh begin_test"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">begin_test</span></code></a></p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Author</dt>
<dd class="field-odd"><p>Ryan Tomayko</p>
</dd>
</dl>
<dl class="function">
<dt id="function-testlib.bsh skip_next_test">
<code class="sig-name descname">skip_next_test</code><a class="headerlink" href="#function-testlib.bsh skip_next_test" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Function to indicate the next test should be skipped</p>
<p>This is the first part of creating a skippable test, used in conjunction with <a class="reference internal" href="#function-testlib.bsh setup_test"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">setup_test</span></code></a></p>
<p class="rubric">Example</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>For example, skip <span class="k">if</span> docker <span class="nb">command</span> not found

  <span class="nb">command</span> -v docker <span class="p">&amp;</span>&gt; /dev/null <span class="o">&amp;&amp;</span> skip_next_test
  begin_test <span class="s2">&quot;My test&quot;</span>
  <span class="o">(</span>
    setup_test
    <span class="o">[</span> <span class="s2">&quot;</span><span class="k">$(</span>docker run -it --rm ubuntu:14.04 <span class="nb">echo</span> hi<span class="k">)</span><span class="s2">&quot;</span> <span class="o">=</span> <span class="s2">&quot;hi&quot;</span> <span class="o">]</span>
  <span class="o">)</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#function-testlib.bsh setup_test"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">setup_test</span></code></a></p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This must be done outside of the test, or else the skip variable will not be set and detected by <a class="reference internal" href="#function-testlib.bsh end_test"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">end_test</span></code></a></p>
</div>
<dl class="function">
<dt id="function-testlib.bsh not">
<code class="sig-name descname">not</code><a class="headerlink" href="#function-testlib.bsh not" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">$1</span></code>… - Command and arguments</p>
</dd>
<dt class="field-even">Output</dt>
<dd class="field-even"><p>Return value</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> - On non-zero return code evaluation</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> - On zero return code</p></li>
</ul>
</dd>
</dl>
<p>Returns true only when the command fails</p>
<p>Since <code class="docutils literal notranslate"><span class="pre">!</span></code> is ignored by “set -e”, use <a class="reference internal" href="#function-testlib.bsh not"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">not</span></code></a> instead. This is just a helper to make unittests look nice and not need extra ifs everywhere</p>
<p class="rubric">Example</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># No good, always passes, even if ! true</span>
! <span class="nb">false</span>

<span class="c1"># good</span>
not <span class="nb">false</span>
<span class="c1"># equivalent to</span>
<span class="k">if</span> ! false<span class="p">;</span> <span class="k">then</span>
  <span class="nb">true</span>
<span class="k">else</span>
  <span class="nb">false</span>
<span class="k">fi</span>
</pre></div>
</div>
<p class="rubric">Bugs</p>
<dl class="simple">
<dt>Complex statements do not work, e.g. [, [[ and ((, etc…</dt><dd><p>For example, you should use</p>
</dd>
</dl>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span> ! -e /test <span class="o">]</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">instead of</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>not <span class="o">[</span> -e /test <span class="o">]</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">In cases where this is not easily worked around, you can use</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>not_s <span class="s1">&#39;[ -e /test ]&#39;</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#function-testlib.bsh not_s"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">not_s</span></code></a></p>
</div>
<dl class="function">
<dt id="function-testlib.bsh not_s">
<code class="sig-name descname">not_s</code><a class="headerlink" href="#function-testlib.bsh not_s" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">$1</span></code> - Command/statement in a single string</p>
</dd>
<dt class="field-even">Output</dt>
<dd class="field-even"><p>Return Value:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> - On non-zero return code evaluation</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> - On zero return code</p></li>
</ul>
</dd>
</dl>
<p>Returns true only when the string version of command fails</p>
<p>Since <code class="docutils literal notranslate"><span class="pre">!</span></code> is ignored by “set -e”, use <a class="reference internal" href="#function-testlib.bsh not"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">not</span></code></a> instead. This is just a helper to make unittests look nice and not need extra ifs everywhere.</p>
<p class="rubric">Example</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">x</span><span class="o">=</span><span class="nb">test</span>
<span class="nv">y</span><span class="o">=</span>t.st
not2 <span class="s1">&#39;[[ $x =~ $y ]]&#39;</span> <span class="c1"># &lt;-- notice single quotes.</span>
</pre></div>
</div>
<p>While the single quotes aren’t necessary, they handle the more complicated situations more easily.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Uses eval</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#function-testlib.bsh not"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">not</span></code></a></p>
</div>
<dl class="function">
<dt id="function-testlib.bsh track_touched_files">
<code class="sig-name descname">track_touched_files</code><a class="headerlink" href="#function-testlib.bsh track_touched_files" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Start tracking touched files</p>
<p>After running <a class="reference internal" href="#function-testlib.bsh track_touched_files"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">track_touched_files</span></code></a>, any call to touch will cause that file to be added to the internal list (touched_files). Just prior to the teardown phase, all of these files will be automatically removed for your convenience.</p>
<p class="rubric">Example</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>setup<span class="o">()</span>
<span class="o">{</span>
  track_touched_files
<span class="o">}</span>
begin_test Testing
<span class="o">(</span>
  touch /tmp/hiya
<span class="o">)</span>
end_test
</pre></div>
</div>
<p class="rubric">Usage</p>
<p>Should be called before the <a class="reference internal" href="#function-testlib.bsh begin_test"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">begin_test</span></code></a> block, not inside. Inside a () subshell block will not work. Setup is the logical place to put it.</p>
<p class="rubric">Bugs</p>
<p>Does not work in sh, only <code class="docutils literal notranslate"><span class="pre">bash</span></code>. Uses array, and I didn’t want to make this use a string instead.</p>
<p>Not thread safe. Use a different file for each thread</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#function-testlib.bsh cleanup_touched_files"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">cleanup_touched_files</span></code></a></p>
</div>
<dl class="function">
<dt id="function-testlib.bsh ttouch">
<code class="sig-name descname">ttouch</code><a class="headerlink" href="#function-testlib.bsh ttouch" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Touch function that should behave like the original touch command</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#function-testlib.bsh track_touched_files"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">track_touched_files</span></code></a></p>
</div>
<dl class="function">
<dt id="function-testlib.bsh cleanup_touched_files">
<code class="sig-name descname">cleanup_touched_files</code><a class="headerlink" href="#function-testlib.bsh cleanup_touched_files" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Delete all the touched files</p>
<p>At the end of the last test, delete all the files in the array</p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../python/modules.html" class="btn btn-neutral float-right" title="vsi" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="test_utils.auto.html" class="btn btn-neutral float-left" title="Test Utilities" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Vision Systems, Inc

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>