#!/usr/bin/env bash

. "$(dirname "${BASH_SOURCE[0]}")/testlib.bsh"

VSI_COMMON_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")/.."; pwd)"

common_yarp_test()
{
  [ "$(echo 'a:' | yarp)" = "a = " ]
}

begin_test "yarp metadata"
(
  setup_test
  . "${VSI_COMMON_DIR}/linux/yarp"

  [ "$(_yarp_meta < /dev/null)" = "" ]
  [ "$(echo "" | _yarp_meta)" = "-1 0" ]
  [ "$(echo "a:" | _yarp_meta)" = "0 0" ]
  [ "$(echo "  a:" | _yarp_meta)" = "2 0" ]
  [ "$(echo $'a:\n  b:\n    c: \n - d' | _yarp_meta)" = $'0 0\n2 0\n4 0\n1 1' ]
)
end_test

begin_test "yarp function"
(
  setup_test
  . "${VSI_COMMON_DIR}/linux/yarp"

  [ "$(type -t yarp)" = "function" ]

  common_yarp_test
)
end_test

begin_test "yarp CLI"
(
  setup_test

  [ "$(type -t yarp)" = "file" ]

  common_yarp_test
)
end_test